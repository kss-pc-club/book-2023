---
title: ニコニコ動画風コメント掲示板２はこうやって作られた
author: 張替健太/hrkn63_hnm
---

# ニコニコ動画風コメント掲示板２はこうやって作られた

<span class="author">張替健太/hrkn63_hnm</span>

## はじめに
みなさんこんにちは。6期生の張替健太です。趣味で生徒会をやったり、SNSを作ったりしています。

僕の記事では、おそらく文化祭当日に展示されているであろう「ニコニコ動画風コメント掲示板２」について紹介します。

ソースコードはこちらです。
https://github.com/hrkn63-hnm/nikoniko-board 

## ニコニコ動画風コメント掲示板２とは

まずは「ニコニコ動画風コメント掲示板２」の「ニコニコ動画風」について。

ニコニコ動画(https://www.nicovideo.jp/ )とは、YouTubeと同じ動画投稿プラットフォームの一つです。誰かがあげた動画を他の誰かが閲覧して楽しむことができます。ニコニコ動画の醍醐味といえば、この弾幕コメントです。

![弾幕コメントのいい例](https://media.discordapp.net/attachments/757627473427955867/1104786970867159111/2023-05-08_0.04.55.png )

【実況】アマガミやるお（＾ω＾）part1/うんこちゃん
(https://www.nicovideo.jp/watch/sm27054304 )より

このニコニコ動画のような熱いコメントが横から流れる掲示板。それが「ニコニコ動画風コメント掲示板２」です。

![実際のプロダクト](https://media.discordapp.net/attachments/757627473427955867/1105048455430295613/nikoniko-board.vercel.app__1.png )

画像は開発中のものです。実際のものとは少し違うかも。

この「ニコニコ動画風コメント掲示板」は去年の文化祭でも掲示しました。そのパワーアップバージョンが今回のものになります。


## ニコニコ動画風コメント掲示板２を支える技術
`Next.js`というフレームワークを用いています。データベースは`Firebase Firestore`を使っていて、`GitHub`へpushすると`Vercel`にそのままdeployできるようになっています。

`Next.js 13`では`yarn create-next-app`を実行すると`Tailwind.css`を使うかどうか聞いてくるようになり、誘惑に負けてそのまま採用しました。


## 技術的な話
個人的トピックを厳選しました。

### 1.型定義について
`TypeScript`を使用しているので型定義を行うのは当たり前ですが、`tsconfig.json`ファイルの型定義設定をいつも甘くしているせいで痛い目に遭いました。

今回、コメントが何文字か、コメントのフィールドに含まれるIDがどんな数で割り切れるのか、で分岐させてCSSを変更させることで色や流れる高さを変えるような仕様を目指しました。

各コメントデータのフィールドに含まれるIDを調べるのは少し面倒で`forEach`などをこねくり回して使う必要があるので、「ドキュメントIDをそのまま参照して割り切れるかどうか調べればいいや！」をしました。

結果、`Firebase Firestore`のドキュメントIDは`string`型でないといけないのにも関わらず、`number`型をぶち込んでいることに気が付かず格闘しました。

ベストプラクティスではないことはわかっていましたが、ドキュメントIDは`string`型にして、分岐させるときは`Number()`を使って`number`に戻して処理を行いました。

### 2.この世の数字の分類について
先ほどの話にもある通り、「どんな数で割り切れるか」「割った余りがいくつか」でコメントを分類しているため、「２で割り切れるかどうか」という処理しか行わなければ、ドキュメントID「10980」と「34506」は同じCSSが適応され、二つのコメントが被り、見づらくなってしまいます。

僕は脳死で「3で割り切れるかどうか」「５で割り切れるかどうか」というように素数で処理を重ねましたが、

### これは絶対に良くない！！

というのも、これは明らかに偏りの出る分類方法だからです。

1~100の中で2の倍数は50個。

2の倍数でなく、3の倍数なのは33-16=17個。

2の倍数の方が明らかに多く、ムラが出来てしまいます。16→8→4→2の順で調べた方がいいのか、`else if`を使うのが良くないのか。はたまた、うまく分類なんてできないのか...

プログラミングが上手な人はこういう時うまく対処できる人なんでしょう。多分。

### 3.コメントを横に流すCSS
実は、`ChatGPT`に聞いてCSSをコピペしました。多少の改善は行なったものの、凄すぎます。

![ChatGPTの功績](https://media.discordapp.net/attachments/757627473427955867/1105050032270487613/CSS_-_chat.openai.com.png )

## おわりに
自分で好きなことをやっているうちに、知識なんて自然とつくもんです。

この掲示板を数時間で作ることができたのも、ホスティングの仕方、データのやり取りの仕方、JSXの条件分岐の仕方、`useState`の使い所など昔はできなかったことひとつひとつが勝手に身についていたからです。

この記事を読んで興味を持った人、Webに興味がある人なんかは、初めの方に記載したソースコードをコピペして同じように作ってみてね。

読んでくださり、ありがとうございました。